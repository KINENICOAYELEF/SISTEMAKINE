<!-- Diagnóstico Kinesiológico -->
<div class="d-sm-flex align-items-center justify-content-between mb-4">
    <h1 class="h3 mb-0 text-gray-800">Diagnóstico Kinesiológico</h1>
    <div>
        <button id="save-diagnosis-btn" class="btn btn-success btn-icon-split">
            <span class="icon text-white-50">
                <i class="fas fa-save"></i>
            </span>
            <span class="text">Guardar Diagnóstico</span>
        </button>
    </div>
</div>

<!-- Selector de Paciente -->
<div class="card shadow mb-4">
    <div class="card-header py-3">
        <h6 class="m-0 font-weight-bold text-primary">Paciente Seleccionado</h6>
    </div>
    <div class="card-body">
        <div class="row align-items-center">
            <div class="col-md-6" id="patient-info">
                <p class="mb-1"><strong>Nombre:</strong> <span id="selected-patient-name">Ninguno seleccionado</span></p>
                <p class="mb-1"><strong>RUT:</strong> <span id="selected-patient-rut"></span></p>
                <p class="mb-0"><strong>Edad:</strong> <span id="selected-patient-age"></span></p>
            </div>
            <div class="col-md-6 text-end">
                <button class="btn btn-primary" id="change-patient-btn">
                    <i class="fas fa-user-edit"></i> Cambiar Paciente
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Formulario con navegación de pestañas -->
<div class="card shadow mb-4">
    <div class="card-header py-3">
        <ul class="nav nav-tabs card-header-tabs module-tabs" id="diagnosis-tabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="reasoning-tab" data-bs-toggle="tab" data-bs-target="#reasoning" type="button" role="tab" aria-controls="reasoning" aria-selected="true">Razonamiento Clínico</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="cif-tab" data-bs-toggle="tab" data-bs-target="#cif" type="button" role="tab" aria-controls="cif" aria-selected="false">Categorización CIF</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="probability-tab" data-bs-toggle="tab" data-bs-target="#probability" type="button" role="tab" aria-controls="probability" aria-selected="false">Probabilidad Diagnóstica</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="pain-tab" data-bs-toggle="tab" data-bs-target="#pain" type="button" role="tab" aria-controls="pain" aria-selected="false">Modelo de Dolor</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="flags-tab" data-bs-toggle="tab" data-bs-target="#flags" type="button" role="tab" aria-controls="flags" aria-selected="false">Sistema de Banderas</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="risk-factors-tab" data-bs-toggle="tab" data-bs-target="#risk-factors" type="button" role="tab" aria-controls="risk-factors" aria-selected="false">Factores de Riesgo</button>
            </li>
        </ul>
    </div>
    <div class="card-body">
        <form id="diagnosis-form">
            <div class="tab-content" id="diagnosis-content">
                <!-- Razonamiento Clínico -->
                <div class="tab-pane fade show active" id="reasoning" role="tabpanel" aria-labelledby="reasoning-tab">
                    <div class="patient-form-section">
                        <h4 class="section-header">Problema Principal</h4>
                        <div class="row">
                            <div class="col-md-12 mb-3">
                                <label for="main-problem" class="form-label">Identificación del problema principal</label>
                                <textarea class="form-control" id="main-problem" name="main-problem" rows="3" required></textarea>
                                <div class="form-text">Describa el problema principal del paciente con base en el motivo de consulta y hallazgos relevantes.</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="patient-form-section">
                        <h4 class="section-header">Hipótesis Diagnósticas</h4>
                        <div class="row mb-3">
                            <div class="col-md-10">
                                <label for="hypothesis-input" class="form-label">Nueva hipótesis diagnóstica</label>
                                <input type="text" class="form-control" id="hypothesis-input" placeholder="Escriba una hipótesis diagnóstica">
                            </div>
                            <div class="col-md-2 d-flex align-items-end">
                                <button type="button" class="btn btn-primary w-100" id="add-hypothesis-btn">
                                    <i class="fas fa-plus"></i> Agregar
                                </button>
                            </div>
                        </div>
                        
                        <div class="table-responsive mb-3">
                            <table class="table table-bordered table-hover" id="hypothesis-table">
                                <thead>
                                    <tr>
                                        <th>Hipótesis</th>
                                        <th>Probabilidad</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="hypothesis-list">
                                    <tr>
                                        <td colspan="3" class="text-center">No hay hipótesis agregadas</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-12">
                                <p class="text-muted">
                                    <i class="fas fa-info-circle"></i> Agregue múltiples hipótesis diagnósticas y ordénelas según su probabilidad. Esto ayudará a guiar las pruebas clínicas necesarias.
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="patient-form-section">
                        <h4 class="section-header">Pruebas Clínicas Relevantes</h4>
                        <div class="row">
                            <div class="col-md-12 mb-3">
                                <label for="clinical-tests" class="form-label">Pruebas realizadas y resultados</label>
                                <textarea class="form-control" id="clinical-tests" name="clinical-tests" rows="4"></textarea>
                                <div class="form-text">Detalle las pruebas clínicas realizadas relacionadas con las hipótesis planteadas y sus resultados.</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="patient-form-section">
                        <h4 class="section-header">Diagnóstico Kinesiológico Final</h4>
                        <div class="row">
                            <div class="col-md-12 mb-3">
                                <label for="final-diagnosis" class="form-label">Diagnóstico final</label>
                                <textarea class="form-control" id="final-diagnosis" name="final-diagnosis" rows="3" required></textarea>
                                <div class="form-text">Escriba el diagnóstico kinesiológico final basado en el análisis de hipótesis y pruebas clínicas.</div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12 mb-3">
                                <label for="scientific-evidence" class="form-label">Referencias a literatura científica</label>
                                <textarea class="form-control" id="scientific-evidence" name="scientific-evidence" rows="3"></textarea>
                                <div class="form-text">Opcionalmente, agregue referencias a literatura científica que respalde su diagnóstico.</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Categorización CIF -->
                <div class="tab-pane fade" id="cif" role="tabpanel" aria-labelledby="cif-tab">
                    <div class="patient-form-section">
                        <h4 class="section-header">Deficiencia Estructural/Funcional</h4>
                        <div class="row">
                            <div class="col-md-8 mb-3">
                                <label for="cif-deficiency-description" class="form-label">Descripción de la deficiencia</label>
                                <textarea class="form-control" id="cif-deficiency-description" name="cif-deficiency-description" rows="3"></textarea>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="cif-deficiency-code" class="form-label">Códigos CIF</label>
                                <input type="text" class="form-control" id="cif-deficiency-code" name="cif-deficiency-code" placeholder="Ej: b710.3">
                                <div class="form-text">Utilice los códigos CIF apropiados para la deficiencia.</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="patient-form-section">
                        <h4 class="section-header">Limitación de Actividad</h4>
                        <div class="row">
                            <div class="col-md-8 mb-3">
                                <label for="cif-activity-description" class="form-label">Descripción de la limitación</label>
                                <textarea class="form-control" id="cif-activity-description" name="cif-activity-description" rows="3"></textarea>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="cif-activity-level" class="form-label">Nivel de restricción</label>
                                <select class="form-control" id="cif-activity-level" name="cif-activity-level">
                                    <option value="">Seleccionar...</option>
                                    <option value="0">0 - NO hay problema</option>
                                    <option value="1">1 - Problema LIGERO</option>
                                    <option value="2">2 - Problema MODERADO</option>
                                    <option value="3">3 - Problema GRAVE</option>
                                    <option value="4">4 - Problema COMPLETO</option>
                                    <option value="8">8 - Sin especificar</option>
                                    <option value="9">9 - No aplicable</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="cif-activity-code" class="form-label">Códigos CIF</label>
                                <input type="text" class="form-control" id="cif-activity-code" name="cif-activity-code" placeholder="Ej: d450.2">
                            </div>
                        </div>
                    </div>
                    
                    <div class="patient-form-section">
                        <h4 class="section-header">Restricción de Participación</h4>
                        <div class="row">
                            <div class="col-md-8 mb-3">
                                <label for="cif-participation-description" class="form-label">Ámbitos afectados</label>
                                <textarea class="form-control" id="cif-participation-description" name="cif-participation-description" rows="3"></textarea>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="cif-participation-level" class="form-label">Nivel de restricción</label>
                                <select class="form-control" id="cif-participation-level" name="cif-participation-level">
                                    <option value="">Seleccionar...</option>
                                    <option value="0">0 - NO hay problema</option>
                                    <option value="1">1 - Problema LIGERO</option>
                                    <option value="2">2 - Problema MODERADO</option>
                                    <option value="3">3 - Problema GRAVE</option>
                                    <option value="4">4 - Problema COMPLETO</option>
                                    <option value="8">8 - Sin especificar</option>
                                    <option value="9">9 - No aplicable</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="cif-participation-code" class="form-label">Códigos CIF</label>
                                <input type="text" class="form-control" id="cif-participation-code" name="cif-participation-code" placeholder="Ej: d850.3">
                            </div>
                        </div>
                    </div>
                    
                    <div class="patient-form-section">
                        <h4 class="section-header">Factores Contextuales</h4>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="cif-facilitators" class="form-label">Facilitadores</label>
                                <textarea class="form-control" id="cif-facilitators" name="cif-facilitators" rows="3"></textarea>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="cif-barriers" class="form-label">Barreras</label>
                                <textarea class="form-control" id="cif-barriers" name="cif-barriers" rows="3"></textarea>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="cif-facilitators-code" class="form-label">Códigos Facilitadores</label>
                                <input type="text" class="form-control" id="cif-facilitators-code" name="cif-facilitators-code" placeholder="Ej: e310+3">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="cif-barriers-code" class="form-label">Códigos Barreras</label>
                                <input type="text" class="form-control" id="cif-barriers-code" name="cif-barriers-code" placeholder="Ej: e150.2">
                            </div>
                        </div>
                    </div>
                    
                    <div class="patient-form-section">
                        <h4 class="section-header">Visualización Interrelación CIF</h4>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="cif-visualization-container" id="cif-visualization">
                                    <!-- Se cargará con JavaScript -->
                                    <div class="alert alert-info">
                                        El diagrama de interrelación CIF se generará aquí basado en los datos ingresados.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Probabilidad Diagnóstica -->
                <div class="tab-pane fade" id="probability" role="tabpanel" aria-labelledby="probability-tab">
                    <div class="patient-form-section">
                        <h4 class="section-header">Calculadora de Probabilidad Diagnóstica</h4>
                        <!-- Contenido para calculadora de probabilidad diagnóstica -->
                        <div class="row">
                            <div class="col-md-12">
                                <div class="alert alert-info">
                                    Esta sección calculará la probabilidad diagnóstica basada en la evidencia científica y hallazgos clínicos.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Modelo de Dolor -->
                <div class="tab-pane fade" id="pain" role="tabpanel" aria-labelledby="pain-tab">
                    <div class="patient-form-section">
                        <h4 class="section-header">Clasificación según Mecanismo Predominante</h4>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="pain-mechanism" id="pain-nociceptive" value="nociceptive">
                                    <label class="form-check-label" for="pain-nociceptive">
                                        <strong>Nocioceptivo</strong>
                                    </label>
                                    <p class="text-muted small mt-1">Dolor relacionado con daño tisular real o potencial.</p>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="pain-mechanism" id="pain-neuropathic" value="neuropathic">
                                    <label class="form-check-label" for="pain-neuropathic">
                                        <strong>Neuropático</strong>
                                    </label>
                                    <p class="text-muted small mt-1">Dolor causado por lesión o enfermedad del sistema nervioso somatosensorial.</p>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="pain-mechanism" id="pain-nociplastic" value="nociplastic">
                                    <label class="form-check-label" for="pain-nociplastic">
                                        <strong>Nociplástico</strong>
                                    </label>
                                    <p class="text-muted small mt-1">Dolor que surge de la nocicepción alterada a pesar de que no hay evidencia clara de daño tisular o lesión nerviosa.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="patient-form-section">
                        <h4 class="section-header">Cuestionarios Específicos para Tipo de Dolor</h4>
                        <div class="row">
                            <div class="col-md-12">
                                <p>Seleccione el tipo de dolor para mostrar el cuestionario correspondiente:</p>
                                <div class="btn-group mb-3" role="group">
                                    <button type="button" class="btn btn-outline-primary" id="show-dn4-btn">DN4 (Neuropático)</button>
                                    <button type="button" class="btn btn-outline-primary" id="show-paindetect-btn">PainDETECT (Neuropático)</button>
                                    <button type="button" class="btn btn-outline-primary" id="show-central-btn">Sensibilización Central</button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Contenedor para los cuestionarios de dolor -->
                        <div id="pain-questionnaires-container">
                            <!-- Se cargará dinámicamente con JavaScript -->
                            <div class="alert alert-info">
                                Seleccione un cuestionario para evaluación de dolor específico.
                            </div>
                        </div>
                    </div>
                    
                    <div class="patient-form-section">
                        <h4 class="section-header">Modelo Biopsicosocial</h4>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="bio-factors" class="form-label">Factores Biológicos</label>
                                <textarea class="form-control" id="bio-factors" name="bio-factors" rows="3"></textarea>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="psycho-factors" class="form-label">Factores Psicológicos</label>
                                <textarea class="form-control" id="psycho-factors" name="psycho-factors" rows="3"></textarea>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="social-factors" class="form-label">Factores Sociales</label>
                                <textarea class="form-control" id="social-factors" name="social-factors" rows="3"></textarea>
                            </div>
                        </div>
                    </div>
                    
                    <div class="patient-form-section">
                        <h4 class="section-header">Neurociencia del Dolor Aplicada</h4>
                        <div class="row">
                            <div class="col-md-12 mb-3">
                                <label for="pain-neuroscience" class="form-label">Recomendaciones basadas en neurociencia</label>
                                <textarea class="form-control" id="pain-neuroscience" name="pain-neuroscience" rows="3"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Sistema de Banderas -->
                <div class="tab-pane fade" id="flags" role="tabpanel" aria-labelledby="flags-tab">
                    <div class="patient-form-section">
                        <h4 class="section-header">Sistema de Banderas Automatizado</h4>
                        <div class="row mb-3">
                            <div class="col-md-12">
                                <div class="alert alert-info">
                                    El sistema analizará automáticamente los datos del formulario de ingreso y mostrará alertas según banderas detectadas.
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <div class="card h-100">
                                    <div class="card-header bg-danger text-white">
                                        <h5 class="mb-0">Banderas Rojas</h5>
                                    </div>
                                    <div class="card-body" id="red-flags-container">
                                        <!-- Se llenará dinámicamente -->
                                        <p class="text-center">Analizando datos...</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="card h-100">
                                    <div class="card-header bg-warning text-dark">
                                        <h5 class="mb-0">Banderas Amarillas</h5>
                                    </div>
                                    <div class="card-body" id="yellow-flags-container">
                                        <!-- Se llenará dinámicamente -->
                                        <p class="text-center">Analizando datos...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <div class="card h-100">
                                    <div class="card-header text-white" style="background-color: #0275d8;">
                                        <h5 class="mb-0">Banderas Azules</h5>
                                    </div>
                                    <div class="card-body" id="blue-flags-container">
                                        <!-- Se llenará dinámicamente -->
                                        <p class="text-center">Analizando datos...</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="card h-100">
                                    <div class="card-header bg-dark text-white">
                                        <h5 class="mb-0">Banderas Negras</h5>
                                    </div>
                                    <div class="card-body" id="black-flags-container">
                                        <!-- Se llenará dinámicamente -->
                                        <p class="text-center">Analizando datos...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="patient-form-section">
                        <h4 class="section-header">Recomendaciones Específicas</h4>
                        <div class="row">
                            <div class="col-md-12 mb-3">
                                <label for="flags-recommendations" class="form-label">Recomendaciones según banderas identificadas</label>
                                <textarea class="form-control" id="flags-recommendations" name="flags-recommendations" rows="3"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Factores de Riesgo -->
                <div class="tab-pane fade" id="risk-factors" role="tabpanel" aria-labelledby="risk-factors-tab">
                    <div class="patient-form-section">
                        <h4 class="section-header">Identificación de Factores de Riesgo</h4>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="alert alert-info">
                                    Sección para identificar factores de riesgo específicos.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>
